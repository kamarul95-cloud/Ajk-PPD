<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <title>Senarai Ahli Jawatankuasa Pemuda</title>
  <style id="theme-style">
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #fff;
      color: #000;
    }
    .dark body {
      background-color: #1c1c1c;
      color: #eee;
    }
    h2 {
      margin-bottom: 10px;
    }
    #search, #jawatanFilter, #templateMsg {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }
    .dark #search, .dark #jawatanFilter, .dark #templateMsg {
      background-color: #2b2b2b;
      border-color: #444;
      color: #eee;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .dark th, .dark td {
      border-color: #333;
    }
    th {
      background-color: #eee;
    }
    .dark th {
      background-color: #333;
    }
    a {
      color: #1a73e8;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    #countInfo {
      margin-top: 10px;
      font-style: italic;
    }
    #toggleTheme {
      margin-bottom: 15px;
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<button id="toggleTheme">Tukar ke Mod Gelap</button>
<h2>Senarai Ahli Jawatankuasa Pemuda</h2>
<input type="text" id="search" placeholder="Cari nama atau jawatan…">
<select id="jawatanFilter">
  <option value="">Tapis mengikut jawatan…</option>
</select>
<textarea id="templateMsg" rows="3" placeholder="Tulis mesej WhatsApp templat di sini…"></textarea>
<p id="countInfo"></p>

<table id="senarai">
  <thead>
    <tr>
      <th>Bil</th>
      <th>Nama</th>
      <th>Jawatan</th>
      <th>No. IC</th>
      <th>No. Telefon</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script>
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQwRhl3FVUAF_EuykuzHfy6IVFgT3Govb06k4puLaQy8j7wJuI194KxNSC_zGjKhcyM2sFwEazuU9Z4/pub?gid=0&single=true&output=csv";
  let allRows = [];

  fetch(url)
    .then(r => r.text())
    .then(csv => {
      const results = Papa.parse(csv, { skipEmptyLines: true });
      allRows = results.data.slice(1);
      populateFilter(allRows);
      populateTable(allRows);
    });

  function populateTable(rows) {
    const tbody = document.querySelector("#senarai tbody");
    const countInfo = document.getElementById("countInfo");
    const msgTemplate = document.getElementById("templateMsg").value.trim();
    tbody.innerHTML = "";

    rows.forEach(cols => {
      let bil = cols[0] || "-";
      let nama = cols[1] || "-";
      let jawatan = cols[2] || "-";
      let icTelefonRaw = cols[3] || "";
      let parts = icTelefonRaw.split(/\r?\n/);
      let ic = parts[0] || "-";
      let telRaw = parts[1] || "";
      let telefon = telRaw.replace(/[^0-9]/g, '');
      if (telefon.startsWith("0")) telefon = "60" + telefon.slice(1);
      let waLink = telefon
        ? `<a href="https://wa.me/${telefon}?text=${encodeURIComponent(msgTemplate)}" target="_blank">${telRaw}</a>`
        : "-";

      tbody.insertAdjacentHTML("beforeend", `
        <tr>
          <td>${bil}</td>
          <td>${nama}</td>
          <td>${jawatan}</td>
          <td>${ic}</td>
          <td>${waLink}</td>
        </tr>
      `);
    });

    countInfo.textContent = `Jumlah rekod: ${rows.length}`;
  }

  function populateFilter(rows) {
    let set = new Set(rows.map(r => r[2]));
    let sel = document.getElementById("jawatanFilter");
    Array.from(set).sort().forEach(j => sel.add(new Option(j, j)));
  }

  document.getElementById("search").addEventListener("input", filterAndSearch);
  document.getElementById("jawatanFilter").addEventListener("change", filterAndSearch);
  document.getElementById("templateMsg").addEventListener("input", () => populateTable(filterRows()));

  function filterAndSearch() {
    const rows = filterRows();
    populateTable(rows);
  }

  function filterRows() {
    let kw = document.getElementById("search").value.toLowerCase();
    let job = document.getElementById("jawatanFilter").value;
    return allRows.filter(r => {
      let nama = (r[1] || "").toLowerCase();
      let jaw = (r[2] || "").toLowerCase();
      return (nama.includes(kw) || jaw.includes(kw)) && (job ? r[2] === job : true);
    });
  }

  // Theme toggle
  const btnToggle = document.getElementById("toggleTheme");
  btnToggle.addEventListener("click", () => {
    document.documentElement.classList.toggle("dark");
    btnToggle.textContent = document.documentElement.classList.contains("dark")
      ? "Tukar ke Mod Terang"
      : "Tukar ke Mod Gelap";
  });
</script>

</body>
</html>
